<div class="mx-3 my-1">
    <!-- „Éí„Éº„É≠„Éº„Ç®„É™„Ç¢ -->
    <h2>„Éí„Éº„É≠„Éº„Ç®„É™„Ç¢</h2>

    <!-- „Éû„ÉÉ„Éó„Ç®„É™„Ç¢ -->
    <h2>üó∫Ô∏è „Ç¥„Éü„ÅÆÂàÜÂ∏É„Éû„ÉÉ„Éó</h2>
    <div class="mx-3 my-3">
        <input type="hidden" id="point" value=<%= @post %>>
        <div id='map'></div>
        <style>
            #map{
                height: 400px;
            }
        </style>

        <script>
            let map
            var map_lng
            var marker
            var points

            function initMap(){
                console.log(gon.points)
                map = new google.maps.Map(document.getElementById('map'), {
                    center: {lat: 35.689, lng: 139.692},
                    zoom: 8
                });

                for (var i=0; i < gon.points.length; i++){
                    if (gon.points[i][0] != null){
                        position = {lat: gon.points[i][0], lng: gon.points[i][1]}
                        marker = new google.maps.Marker({
                            position: position,
                            map: map,
                        });
                    }
                }
            }
        </script>
        <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDUlzlxRykzbuGrjaKcDOl6AZhKUfGWCUA&callback=initMap" async defer></script>
    </div>

    <!-- ÊúÄÊñ∞ÊäïÁ®ø -->
    <% if logged_in? %>
        <h2><%= link_to "üì∏ ÊúÄÊñ∞„ÅÆÊäïÁ®ø", user_posts_path(user_id: current_user) %></h2>
    <% else %>
        <h2><%= link_to "üì∏ ÊúÄÊñ∞„ÅÆÊäïÁ®ø", login_path %></h2>
    <% end %>
    <div class="row">
        <% @post.first(3).each do |post| %>
            <div class="col-md-4">
                <div class="card mx-3 my-3" style="">
                    <% if post.image.attached? %>
                        <%= image_tag post.image, size: "",  class: "d-block mx-auto img-fluid", style: "width: 100%; height: 200px; object-fit:cover;" %><br>
                    <% else %>
                        <img src="http://placehold.jp/150x150" class="d-block mx-auto img-fluid" style="width: 100%; height: 200px; object-fit:cover;"><br>
                    <% end %>

                    <div class="mx-1 my-3">
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item"><%= post.created_at %></li>
                            <li class="list-group-item">„É¶„Éº„Ç∂„ÉºÔºö<%= post.user.name %></li>
                            <li class="list-group-item">„Ç´„ÉÜ„Ç¥„É™Ôºö<%= post.category.g_type %></li>
                            <li class="list-group-item">Âú∞Âüü„ÄÄ„ÄÄÔºö<%= post.point %></li>
                            <li class="list-group-item"><%= post.description %></li>

                            <% if logged_in? %>
                                <%= link_to "Ë©≥Á¥∞", user_post_path(user_id: current_user, id: post.id), class: "btn btn-primary" %>
                            <% else %>
                                <%= link_to "Ë©≥Á¥∞", login_path, class: "btn btn-primary" %>
                            <% end %>
                        </ul>

                        <% if logged_in? %>
                            <% if post.favorited_by?(current_user, post) %>
                                <p>
                                    <span>
                                        „ÅäÊ∞ó„Å´ÂÖ•„ÇäËß£Èô§: 
                                    </span>
                                    <%= link_to post.favorites.count, user_post_favorites_path(user_id: current_user, post_id: post.id), data: { "turbo-method": :delete } %>
                                </p>
                            <% else %>
                                <p>
                                    <span>
                                        „ÅäÊ∞ó„Å´ÂÖ•„ÇäÁôªÈå≤: 
                                    </span>
                                    <%= link_to post.favorites.count, user_post_favorites_path(user_id: current_user, post_id: post.id), data: { "turbo-method": :post } %>
                                </p>
                            <% end %>
                        <% else %>
                            <p>
                                <span>
                                    „ÅäÊ∞ó„Å´ÂÖ•„ÇäÁôªÈå≤: 
                                </span>
                                <%= post.favorites.count %>
                            </p>
                        <% end %>
                    </div>
                </div>
            </div>
        <% end %>
    </div>


    <!-- „É©„É≥„Ç≠„É≥„Ç∞ -->
    <h2>üèÜ „É©„É≥„Ç≠„É≥„Ç∞</h2>
    <div class="row">
        <div class="col-md-4">
            <div class="card mx-3 my-3">
                <div class="card-header">
                    <h3>‚ù§Ô∏è „ÅÑ„ÅÑ„Å≠„É©„É≥„Ç≠„É≥„Ç∞</h3>
                </div>
                <ul class="list-group list-group-flush">
                    <% @user_ranking.each_with_index do |post, i| %>
                        <li class="list-group-item"><%= i+1 %>‰Ωç<%= @user.find(post).name %> </li>
                    <% end %>
                </ul>
            </div>
        </div>


        <div class="col-md-4">
            <div class="card mx-3 my-3">
                <div class="card-header">
                    <h3>üåè Âú∞ÂüüÂà•„É©„É≥„Ç≠„É≥„Ç∞</h3>
                </div>
                <ul class="list-group list-group-flush">
                    <% @user_ranking.each_with_index do |post, i| %>
                        <li class="list-group-item"><%= i+1 %>‰Ωç<%= @user.find(post).name %> </li>
                    <% end %>
                </ul>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card mx-3 my-3">
                <div class="card-header">
                    <h3>üë§ „É¶„Éº„Ç∂„Éº„É©„É≥„Ç≠„É≥„Ç∞</h3>
                </div>
                <ul class="list-group list-group-flush">
                    <% @user_ranking.each_with_index do |post, i| %>
                        <li class="list-group-item"><%= i+1 %>‰Ωç<%= @user.find(post).name %> </li>
                    <% end %>
                </ul>
            </div>
        </div>
    </div>
</div>
